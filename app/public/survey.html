<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Friend Finder</title>
    
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <div class="row">
                <div class="col s12">
                    <h1 class="center-align">Friend Finder</h1>
                </div>
            </div>
        </header>

        <main>
            <div class="row">
                <div class="col s12">
                    <div class="card blue lighten-5 grey-text text-darken-3">
                        <div class="card-content">
                            <h2 class="card-title center-align">About You</h2>

                            <div class="input-field">
                                <input type="text" id="name" class="validate" required>
                                <label for="name" class="grey-text text-darken-2">Name (Required)</label>
                            </div>

                            <div class="input-field">
                                <input type="text" id="photo" class="validate" required>
                                <label for="photo" class="grey-text text-darken-2">Link to Photo Image (Required)</label>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 1</h3>

                            <p>Generally, you don't easily become irritated.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 2</h3>

                            <p>You are punctual most of the time.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 3</h3>

                            <p>You enjoy meeting new people.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 4</h3>

                            <p>You are eager to try new things.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 5</h3>

                            <p>Your workplace and/or home is often messy.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 6</h3>

                            <p>You consider yourself to be an imaginative person.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 7</h3>

                            <p>It is hard for you to develop new relationships.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 8</h3>

                            <p>You prefer as few deviations to your daily routine as possible.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 9</h3>

                            <p>You are generally respectful towards people.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    

                    <div class="card light-blue lighten-5">
                        <div class="card-content">
                            <h3 class="card-title">Question 10</h3>

                            <p>You become anxious easily.</p>

                            <div class="input-field">
                                <select>
                                    <option value="" disabled selected>Select an option</option>
                                    <option value="1">1 (Strongly Disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly Agree)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn blue waves-effect waves-blue" type="submit" id="submit">Submit
                        <i class="material-icons right">send</i>
                    </button>
                </div>
            </div>
        </main>

        <footer>
            <div class="row">
                <div class="col s12">
                    <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/homr0/FriendFinder">GitHub Repository</a></p>
                </div>
            </div>
        </footer>

        <!-- Modals -->
        <div id="needName" class="modal">
            <div class="modal-content">
                <h3>Error: Invalid name</h3>

                <p>Please put a valid name in the <strong>Name</strong> field.</p>
            </div>
        </div>
        
        <div id="needPhoto" class="modal">
            <div class="modal-content">
                <h3>Error: Invalid photo link</h3>

                <p>Please put a valid link in the <strong>Link to Photo Image</strong> field.</p>
            </div>
        </div>

        <div id="needAnswers" class="modal">
            <div class="modal-content">
                <h3>Error: Invalid response(s)</h3>

                <p>Please make sure you have answered the following questions:<br>
                <strong id="unanswered"></strong></p>
            </div>
        </div>

        <div id="friendMatch" class="modal">
            <div class="modal-content">
                <div class="card">
                    <div class="card-image">
                        <img  id="friend-photo" src="http://pixsector.com/cache/94bed8d5/av3cbfdc7ee86dab9a41d.png" alt="Your friend">
                    </div>

                    <div class="card-content">
                        <h4>Congratulations!</h4>

                        <p><strong id="friend-name"></strong> is your closest match from our Friend Finder.</p>

                        <p>Feel free to take the <a href="/survey">survey</a> again or return to the <a href="/">home</a> page.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
        $(document).ready(function() {
            $("select").formSelect();
            $(".modal").modal();

            // Validates the user information.
            function validate(user) {
                // Checks the user's name.
                if(user.name === "") {
                    $("#needName").modal("open");
                    return false;
                }

                // Checks the user's photo.
                if(user.photo === "") {
                    $("#needPhoto").modal("open");
                    return false;
                }

                // Checks the user's scores.
                var needScore = [];

                $("#unanswered").text("");

                for(var i = 0; i < user.scores.length; i++) {
                    if(isNaN(user.scores[i])) needScore.push(i);
                }

                if(needScore.length > 0) {
                    $("#unanswered").text(needScore.map(x => x + 1).join(", "));
                    $("#needAnswers").modal("open");
                    return false;
                }

                return true;
            }

            $("#submit").on("click", function(e) {
                e.preventDefault();

                // Gets all of the user responses.
                var scores = [];
                $("select").each(function() { scores.push(parseInt($(this).val())); })

                var userData = {
                    "name": $("#name").val().trim(),
                    "photo": $("#photo").val().trim(),
                    "scores": scores
                };

                if(validate(userData)) {
                    // Post the user data to get the most compathble friend.
                    $.post("/api/friends", userData).done( function(data) {
                        // Sets the name and photo of the compatible friend.
                        $("#friend-name").text(data.name);
                        $("#friend-photo").attr({
                            "src": data.photo,
                            "alt": data.name
                        });

                        // Opens the modal of the most compatible match.
                        $("#friendMatch").modal("open");
                    });
                }
            });
        });
    </script>
</body>
</html>